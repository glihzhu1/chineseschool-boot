<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions">
	
	
    <p:dialog id="listStudentDialog" header="List Class Students" modal="true" widgetVar="listStudentDialogWidget" dynamic="true" resizable="true" maximizable="true" showEffect="fade" hideEffect="explode">
      <p:ajax event="close" update=":dataForm:data" listener="#{semestercourseBean.handleDialogClose}" />
      <p:outputPanel id="listStudentPanel">
        <h:form id="listStudentForm" enctype="multipart/form-data">
          <p:panel id="listStudentPanelGrid">  
            <p:dataTable var="student" value="#{semestercourseBean.selectedStudents}" 
				emptyMessage="no students found for the class" rowKey="#{student.id}" 
		             selection="#{semestercourseBean.student}" selectionMode="single"
		             style="width:800px;">
				<p:column>
					<f:facet name="header">
						<h:outputText value="Student ID -Status" style="color: blue"></h:outputText>
					</f:facet>
					<h:outputText value="#{student.id}" />
					<h:outputText value="#{student.active? ' -A' : ' -I'}" style="font-weight: bold; color: red;"/>
				</p:column>
				<p:column>
					<f:facet name="header">
						<h:outputText value="Name" style="color: blue"></h:outputText>
					</f:facet>
					<h:outputText value="#{student.firstname} #{student.lastname}" />
				</p:column>
				<p:column>
					<f:facet name="header">
						<h:outputText value="Family Email" style="color: blue"></h:outputText>
					</f:facet>
					<h:outputText value="#{student.familyid.email}" />
				</p:column>
				<p:column>
					<f:facet name="header">
						<h:outputText value="Birth Date" style="color: blue"></h:outputText>
					</f:facet>
					<h:outputText value="#{student.dob.time}" >
						<f:convertDateTime pattern="MM/dd/yyyy" type="date"/>
					</h:outputText>
				</p:column>
				<p:column>
					<f:facet name="header">
						<h:outputText value="Gender" style="color: blue"></h:outputText>
					</f:facet>
					<h:outputText value="#{student.gender}" />
				</p:column>
				
				<p:column styleClass="action-column">
		            <f:facet name="header">
		              <h:outputText value="Actions" />
		            </f:facet>
		            <p:commandButton id="deregisterStudentButton" icon="fa fa-fw fa-close"
		              action="#{semestercourseBean.onDeleteFromStudentList}"
		              update="deleteFromStudentListDialog" oncomplete="PF('deleteFromStudentListDialogWidget').show()" title="#{messages.label_create}">
		              <f:setPropertyActionListener value="#{student}" target="#{semestercourseBean.student}" />
		            </p:commandButton>
		            <p:tooltip for="deregisterStudentButton" position="top" value="Deregister" showEffect="fade" hideEffect="fade" />
		            
		            <p:menuButton value="More">
						<p:menuitem value="Email Family" icon="ui-icon-zoomin"
			            	actionListener="#{semestercourseBean.displayEmailStudentDialogOne}"
			            	oncomplete="PF('emailStudentDialogOneWidget').show()"
			      			update=":emailStudentDialogOne">
			      			<f:param name="studentrowid" value="#{student.id}"/>
		      			</p:menuitem>
		      		</p:menuButton>
				</p:column>
		    </p:dataTable>
	      </p:panel>
	      
	      <p:commandButton id="listStudentExportPdfButton" value="Export PDF"
	        onclick="PF('listStudentDialogWidget').hide()" type="button" />
          <p:commandButton id="emailAllFamiliesButton" value="Email Class Families" 
            oncomplete="PF('emailStudentDialogWidget').show()"
            action="#{semestercourseBean.displayEmailStudentDialog}" update=":emailStudentForm:emailStudentPanelGrid" />
          <p:commandButton id="listStudentCloseButton" value="#{messages.label_close}" onclick="PF('listStudentDialogWidget').hide()" type="button" />
          <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
        </h:form>
      </p:outputPanel>
    </p:dialog>
    
    <p:confirmDialog id="deleteFromStudentListDialog" widgetVar="deleteFromStudentListDialogWidget" message="#{messages.label_delete_record}" showEffect="fade" hideEffect="explode" header="#{messages.label_confirm_deletion}" severity="alarm">
      <p:outputPanel id="deleteFromStudentListPanel">
        <h:form id="deleteFromStudentListForm">
          <p:commandButton id="deleteFromStudentListYesButton" value="#{messages.label_yes}" action="#{semestercourseBean.deleteFromStudentListRegisteredStudent}" 
          	update=":listStudentForm:listStudentPanelGrid" 
          	oncomplete="PF('deleteFromStudentListDialogWidget').hide()" />
          <p:commandButton id="deleteFromStudentListNoButton" value="#{messages.label_no}" onclick="PF('deleteFromStudentListDialogWidget').hide()" type="button" />
          <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
        </h:form>
      </p:outputPanel>
    </p:confirmDialog>
    
    <p:dialog id="emailStudentDialog" header="Email All Student's Families"
		width="600" height="300" styleClass="center-block"
    	modal="true" widgetVar="emailStudentDialogWidget" dynamic="true" 
    	visible="#{semestercourseBean.emailStudentDialogVisible}" 
    	showEffect="fade" hideEffect="explode">
      <p:ajax event="close" listener="#{semestercourseBean.handleDialogClose}" />
      <p:outputPanel id="emailStudentPanel">
        <h:form id="emailStudentForm">
          <h:panelGrid id="emailStudentPanelGrid" columns="4" 
          	styleClass="dialog" columnClasses="col1,col2" >
          		<h:outputLabel value="Subject: " />
          		<h:inputText id="emailSubject" required="true" requiredMessage="Email subject is required"
          		  size="50" value="#{semestercourseBean.toStudentEmailSubject}" />
	            <p:watermark for="emailSubject" value="Subject Required" />
	          	<p:message for="emailSubject"></p:message>
	          	
      			<h:outputLabel value="Message: " />
      			<h:inputTextarea rows="5" cols="51" id="emailMessage"
      				value="#{semestercourseBean.toStudentEmailMsg}" 
      				required="true" requiredMessage="Email message cannot be empty"/>	
      			<h:message for="emailMessage" style="color:red" />
      			
    		</h:panelGrid>
    		<br />
          <p:commandButton id="submitEmailButton" value="Submit" action="#{semestercourseBean.sendAllStudentsEmail}" update="emailStudentPanelGrid" />
          <p:commandButton id="emailCloseButton" value="#{messages.label_close}" onclick="PF('emailStudentDialogWidget').hide()" type="button" />
        </h:form>
      </p:outputPanel>
    </p:dialog>
    
    <p:dialog id="emailStudentDialogOne" header="Email Student"
		width="600" height="300" styleClass="center-block"
    	modal="true" widgetVar="emailStudentDialogOneWidget" dynamic="true" 
    	visible="#{semestercourseBean.emailStudentDialogOneVisible}"
    	showEffect="fade" hideEffect="explode">
      <p:ajax event="close" listener="#{semestercourseBean.handleDialogClose}" />
      <p:outputPanel id="emailStudentOnePanel">
        <h:form id="emailStudentOneForm">
          <h:panelGrid id="emailStudentOnePanelGrid" columns="4" 
          	styleClass="dialog" columnClasses="col1,col2" >
          		<h:outputLabel value="Subject: " />
          		<h:inputText id="emailOneSubject" required="true" requiredMessage="Email subject is required"
          		  size="50" value="#{semestercourseBean.toStudentEmailSubject}" />
	            <p:watermark for="emailOneSubject" value="Subject Required" />
	          	<p:message for="emailOneSubject"></p:message>
	          	
      			<h:outputLabel value="Message: " />
      			<h:inputTextarea rows="5" cols="51" id="emailOneMessage"
      				value="#{semestercourseBean.toStudentEmailMsg}" 
      				required="true" requiredMessage="Email message cannot be empty"/>	
      			<h:message for="emailOneMessage" style="color:red" />
      			
    		</h:panelGrid>
    		<br />
          <p:commandButton value="Submit" action="#{semestercourseBean.sendSelectedStudentEmail}" update="emailStudentOnePanelGrid" />
          <p:commandButton value="#{messages.label_close}" onclick="PF('emailStudentDialogOneWidget').hide()" type="button" />
        </h:form>
      </p:outputPanel>
    </p:dialog>
    
    
</ui:composition>